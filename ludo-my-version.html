<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Ludo 4 Pemain</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            color: #333;
            text-align: center;
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 550px;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        #message {
            font-size: 1.2rem;
            font-weight: bold;
            height: 30px;
            margin-bottom: 20px;
        }

        canvas {
            border: 2px solid #34495e;
            border-radius: 10px;
            background-color: #ecf0f1;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        #roll-btn {
            background-color: #3498db;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s, box-shadow 0.3s;
            box-shadow: 0 5px #2980b9;
        }

        #roll-btn:hover {
            background-color: #2980b9;
        }
        
        #roll-btn:active {
            transform: translateY(2px);
            box-shadow: 0 3px #2980b9;
        }

        #dice {
            font-size: 3rem;
            margin-top: 10px;
            font-weight: bold;
            min-width: 60px;
            text-align: center;
        }

        .player-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        #player-turn {
            padding: 5px 10px;
            border-radius: 8px;
            transition: background-color 0.5s;
        }
        
        .red-turn { background-color: #e74c3c; color: white; }
        .yellow-turn { background-color: #f1c40f; color: #333; }
        .green-turn { background-color: #2ecc71; color: white; }
        .blue-turn { background-color: #3498db; color: white; }

    </style>
</head>
<body>
    <div class="game-container">
        <h1>Ludo 4 Pemain</h1>
        <p id="message">Selamat Datang! Pemain Merah, giliranmu.</p>
        <canvas id="ludoCanvas" width="525" height="525"></canvas>
        <div class="controls">
            <button id="roll-btn">Lempar Dadu!</button>
            <div class="player-info">
                <span id="player-turn">Giliran: Pemain Merah</span>
                <span id="dice"></span>
            </div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('ludoCanvas');
        const ctx = canvas.getContext('2d');
        const messageDisplay = document.getElementById('message');
        const rollBtn = document.getElementById('roll-btn');
        const diceDisplay = document.getElementById('dice');
        const playerTurnDisplay = document.getElementById('player-turn');

        const TILE_SIZE = 35;
        const BOARD_WIDTH = 15;
        const BOARD_HEIGHT = 15;

        // Mendefinisikan warna untuk pemain
        const playerColors = {
            'red': '#e74c3c',
            'yellow': '#f1c40f',
            'green': '#2ecc71',
            'blue': '#3498db'
        };

        // Posisi awal, jalur, dan rumah untuk setiap pemain
        const playerInfo = {
            'red': {
                startPos: { x: 6, y: 1 },
                homePos: { x: 7, y: 7 },
                base: [
                    { x: 1, y: 1 }, { x: 1, y: 4 },
                    { x: 4, y: 1 }, { x: 4, y: 4 }
                ],
                path: [
                    { x: 6, y: 1 }, { x: 6, y: 2 }, { x: 6, y: 3 }, { x: 6, y: 4 }, { x: 6, y: 5 }, { x: 5, y: 6 },
                    { x: 4, y: 6 }, { x: 3, y: 6 }, { x: 2, y: 6 }, { x: 1, y: 6 }, { x: 0, y: 7 }, { x: 1, y: 8 },
                    { x: 2, y: 8 }, { x: 3, y: 8 }, { x: 4, y: 8 }, { x: 5, y: 8 }, { x: 6, y: 9 }, { x: 6, y: 10 },
                    { x: 6, y: 11 }, { x: 6, y: 12 }, { x: 6, y: 13 }, { x: 7, y: 14 }, { x: 8, y: 13 }, { x: 8, y: 12 },
                    { x: 8, y: 11 }, { x: 8, y: 10 }, { x: 8, y: 9 }, { x: 9, y: 8 }, { x: 10, y: 8 }, { x: 11, y: 8 },
                    { x: 12, y: 8 }, { x: 13, y: 8 }, { x: 14, y: 7 }, { x: 13, y: 6 }, { x: 12, y: 6 }, { x: 11, y: 6 },
                    { x: 10, y: 6 }, { x: 9, y: 6 }, { x: 8, y: 5 }, { x: 8, y: 4 }, { x: 8, y: 3 }, { x: 8, y: 2 },
                    { x: 8, y: 1 }, { x: 7, y: 0 }
                ],
                finalPath: [
                    { x: 7, y: 1 }, { x: 7, y: 2 }, { x: 7, y: 3 }, { x: 7, y: 4 }, { x: 7, y: 5 }, { x: 7, y: 6 }
                ]
            },
            'blue': {
                startPos: { x: 13, y: 6 },
                homePos: { x: 7, y: 7 },
                base: [
                    { x: 10, y: 1 }, { x: 10, y: 4 },
                    { x: 13, y: 1 }, { x: 13, y: 4 }
                ],
                path: [
                    { x: 13, y: 6 }, { x: 12, y: 6 }, { x: 11, y: 6 }, { x: 10, y: 6 }, { x: 9, y: 6 }, { x: 8, y: 5 },
                    { x: 8, y: 4 }, { x: 8, y: 3 }, { x: 8, y: 2 }, { x: 8, y: 1 }, { x: 7, y: 0 }, { x: 6, y: 1 },
                    { x: 6, y: 2 }, { x: 6, y: 3 }, { x: 6, y: 4 }, { x: 6, y: 5 }, { x: 5, y: 6 }, { x: 4, y: 6 },
                    { x: 3, y: 6 }, { x: 2, y: 6 }, { x: 1, y: 6 }, { x: 0, y: 7 }, { x: 1, y: 8 }, { x: 2, y: 8 },
                    { x: 3, y: 8 }, { x: 4, y: 8 }, { x: 5, y: 8 }, { x: 6, y: 9 }, { x: 6, y: 10 }, { x: 6, y: 11 },
                    { x: 6, y: 12 }, { x: 6, y: 13 }, { x: 7, y: 14 }, { x: 8, y: 13 }, { x: 8, y: 12 }, { x: 8, y: 11 },
                    { x: 8, y: 10 }, { x: 8, y: 9 }, { x: 9, y: 8 }, { x: 10, y: 8 }, { x: 11, y: 8 }, { x: 12, y: 8 },
                    { x: 13, y: 8 }, { x: 14, y: 7 }
                ],
                finalPath: [
                    { x: 13, y: 7 }, { x: 12, y: 7 }, { x: 11, y: 7 }, { x: 10, y: 7 }, { x: 9, y: 7 }, { x: 8, y: 7 }
                ]
            },
            'yellow': {
                startPos: { x: 8, y: 13 },
                homePos: { x: 7, y: 7 },
                base: [
                    { x: 10, y: 10 }, { x: 10, y: 13 },
                    { x: 13, y: 10 }, { x: 13, y: 13 }
                ],
                path: [
                    { x: 8, y: 13 }, { x: 8, y: 12 }, { x: 8, y: 11 }, { x: 8, y: 10 }, { x: 8, y: 9 }, { x: 9, y: 8 },
                    { x: 10, y: 8 }, { x: 11, y: 8 }, { x: 12, y: 8 }, { x: 13, y: 8 }, { x: 14, y: 7 }, { x: 13, y: 6 },
                    { x: 12, y: 6 }, { x: 11, y: 6 }, { x: 10, y: 6 }, { x: 9, y: 6 }, { x: 8, y: 5 }, { x: 8, y: 4 },
                    { x: 8, y: 3 }, { x: 8, y: 2 }, { x: 8, y: 1 }, { x: 7, y: 0 }, { x: 6, y: 1 }, { x: 6, y: 2 },
                    { x: 6, y: 3 }, { x: 6, y: 4 }, { x: 6, y: 5 }, { x: 5, y: 6 }, { x: 4, y: 6 }, { x: 3, y: 6 },
                    { x: 2, y: 6 }, { x: 1, y: 6 }, { x: 0, y: 7 }, { x: 1, y: 8 }, { x: 2, y: 8 }, { x: 3, y: 8 },
                    { x: 4, y: 8 }, { x: 5, y: 8 }, { x: 6, y: 9 }, { x: 6, y: 10 }, { x: 6, y: 11 }, { x: 6, y: 12 },
                    { x: 6, y: 13 }, { x: 7, y: 14 }
                ],
                finalPath: [
                    { x: 8, y: 13 }, { x: 8, y: 12 }, { x: 8, y: 11 }, { x: 8, y: 10 }, { x: 8, y: 9 }, { x: 8, y: 8 }
                ]
            },
            'green': {
                startPos: { x: 1, y: 8 },
                homePos: { x: 7, y: 7 },
                base: [
                    { x: 1, y: 10 }, { x: 1, y: 13 },
                    { x: 4, y: 10 }, { x: 4, y: 13 }
                ],
                path: [
                    { x: 1, y: 8 }, { x: 2, y: 8 }, { x: 3, y: 8 }, { x: 4, y: 8 }, { x: 5, y: 8 }, { x: 6, y: 9 },
                    { x: 6, y: 10 }, { x: 6, y: 11 }, { x: 6, y: 12 }, { x: 6, y: 13 }, { x: 7, y: 14 }, { x: 8, y: 13 },
                    { x: 8, y: 12 }, { x: 8, y: 11 }, { x: 8, y: 10 }, { x: 8, y: 9 }, { x: 9, y: 8 }, { x: 10, y: 8 },
                    { x: 11, y: 8 }, { x: 12, y: 8 }, { x: 13, y: 8 }, { x: 14, y: 7 }, { x: 13, y: 6 }, { x: 12, y: 6 },
                    { x: 11, y: 6 }, { x: 10, y: 6 }, { x: 9, y: 6 }, { x: 8, y: 5 }, { x: 8, y: 4 }, { x: 8, y: 3 },
                    { x: 8, y: 2 }, { x: 8, y: 1 }, { x: 7, y: 0 }, { x: 6, y: 1 }, { x: 6, y: 2 }, { x: 6, y: 3 },
                    { x: 6, y: 4 }, { x: 6, y: 5 }, { x: 5, y: 6 }, { x: 4, y: 6 }, { x: 3, y: 6 }, { x: 2, y: 6 },
                    { x: 1, y: 6 }, { x: 0, y: 7 }
                ],
                finalPath: [
                    { x: 1, y: 7 }, { x: 2, y: 7 }, { x: 3, y: 7 }, { x: 4, y: 7 }, { x: 5, y: 7 }, { x: 6, y: 7 }
                ]
            }
        };
        
        // Objek game untuk menyimpan status permainan
        let game = {
            players: ['red', 'blue', 'yellow', 'green'],
            turn: 'red',
            diceValue: 0,
            pieces: {
                'red': [],
                'blue': [],
                'yellow': [],
                'green': []
            },
            isRollable: true,
            selectedPiece: null
        };

        // Inisialisasi bidak untuk semua pemain
        ['red', 'blue', 'yellow', 'green'].forEach(player => {
            game.pieces[player] = playerInfo[player].base.map(p => ({
                x: p.x,
                y: p.y,
                pos: -1,
                isHome: false,
                isReady: false
            }));
        });
        
        // --- Fungsi-fungsi Menggambar ---
        
        // Menggambar satu petak
        function drawTile(x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            ctx.strokeStyle = '#34495e';
            ctx.strokeRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        }

        // Menggambar petak jalur pemain
        function drawPlayerPath(player) {
            const info = playerInfo[player];
            info.path.forEach(p => drawTile(p.x, p.y, '#ecf0f1'));
            info.finalPath.forEach(p => drawTile(p.x, p.y, playerColors[player]));
            drawTile(info.startPos.x, info.startPos.y, playerColors[player]);
        }

        // Menggambar rumah
        function drawHome() {
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(6 * TILE_SIZE, 6 * TILE_SIZE, 3 * TILE_SIZE, 3 * TILE_SIZE);
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.moveTo(7.5 * TILE_SIZE, 6.5 * TILE_SIZE);
            ctx.lineTo(8.5 * TILE_SIZE, 7.5 * TILE_SIZE);
            ctx.lineTo(7.5 * TILE_SIZE, 8.5 * TILE_SIZE);
            ctx.lineTo(6.5 * TILE_SIZE, 7.5 * TILE_SIZE);
            ctx.closePath();
            ctx.fill();
        }

        // Menggambar pangkalan
        function drawBase(player) {
            const info = playerInfo[player];
            ctx.fillStyle = playerColors[player];
            if (player === 'red') {
                ctx.fillRect(0 * TILE_SIZE, 0 * TILE_SIZE, 6 * TILE_SIZE, 6 * TILE_SIZE);
            } else if (player === 'blue') {
                ctx.fillRect(9 * TILE_SIZE, 0 * TILE_SIZE, 6 * TILE_SIZE, 6 * TILE_SIZE);
            } else if (player === 'yellow') {
                ctx.fillRect(9 * TILE_SIZE, 9 * TILE_SIZE, 6 * TILE_SIZE, 6 * TILE_SIZE);
            } else if (player === 'green') {
                ctx.fillRect(0 * TILE_SIZE, 9 * TILE_SIZE, 6 * TILE_SIZE, 6 * TILE_SIZE);
            }

            info.base.forEach(p => {
                ctx.fillStyle = '#fff';
                ctx.beginPath();
                ctx.arc(p.x * TILE_SIZE + TILE_SIZE / 2, p.y * TILE_SIZE + TILE_SIZE / 2, TILE_SIZE * 0.4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Menggambar semua bidak di posisinya
        function drawPieces() {
            for (const player in game.pieces) {
                game.pieces[player].forEach(piece => {
                    ctx.fillStyle = playerColors[player];
                    ctx.beginPath();
                    ctx.arc(piece.x * TILE_SIZE + TILE_SIZE / 2, piece.y * TILE_SIZE + TILE_SIZE / 2, TILE_SIZE * 0.35, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = '#333';
                    ctx.stroke();
                });
            }
        }
        
        // Menggambar papan secara keseluruhan
        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Gambar latar belakang
            ctx.fillStyle = '#bdc3c7';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            drawBase('red');
            drawBase('blue');
            drawBase('yellow');
            drawBase('green');
            
            drawPlayerPath('red');
            drawPlayerPath('blue');
            drawPlayerPath('yellow');
            drawPlayerPath('green');
            
            drawHome();
            
            drawPieces();
        }

        // --- Fungsi-fungsi Logika Permainan ---

        function updateMessage(msg) {
            messageDisplay.textContent = msg;
        }
        
        const playerNames = {
            'red': 'Merah',
            'blue': 'Biru',
            'yellow': 'Kuning',
            'green': 'Hijau'
        };

        function switchTurn() {
            const currentIndex = game.players.indexOf(game.turn);
            const nextIndex = (currentIndex + 1) % game.players.length;
            game.turn = game.players[nextIndex];

            game.isRollable = true;
            game.selectedPiece = null;
            diceDisplay.textContent = '';
            playerTurnDisplay.textContent = `Giliran: Pemain ${playerNames[game.turn]}`;
            playerTurnDisplay.className = `${game.turn}-turn`;
            updateMessage(`Giliran Pemain ${playerNames[game.turn]}, Lempar Dadu.`);
            drawBoard();
        }

        function rollDice() {
            if (!game.isRollable) return;
            
            game.diceValue = Math.floor(Math.random() * 6) + 1;
            diceDisplay.textContent = game.diceValue;
            game.isRollable = false;

            updateMessage(`Pemain ${playerNames[game.turn]} melempar ${game.diceValue}. Pilih bidak untuk bergerak.`);
            
            // Logika untuk bidak yang bisa digerakkan
            const canMove = game.pieces[game.turn].some(piece => {
                // Jika dadu 6, bisa keluarkan bidak atau gerakkan bidak di jalur
                if (game.diceValue === 6) {
                    return !piece.isReady || (piece.isReady && piece.pos + 6 < playerInfo[game.turn].path.length + playerInfo[game.turn].finalPath.length);
                }
                // Jika dadu bukan 6, hanya bisa gerakkan bidak di jalur
                return piece.isReady && piece.pos + game.diceValue < playerInfo[game.turn].path.length + playerInfo[game.turn].finalPath.length;
            });
            
            if (!canMove) {
                updateMessage("Tidak ada bidak yang bisa digerakkan. Giliran selesai.");
                setTimeout(switchTurn, 1500);
            }
        }

        function movePiece(piece, steps) {
            const player = game.turn;
            const info = playerInfo[player];
            const oldPos = piece.pos;
            const newPos = oldPos + steps;

            // Logika untuk mengeluarkan bidak dari pangkalan
            if (!piece.isReady) {
                if (steps === 6) {
                    piece.isReady = true;
                    piece.pos = 0;
                    const newCoords = info.path[piece.pos];
                    piece.x = newCoords.x;
                    piece.y = newCoords.y;
                    
                    // Cek jika ada bidak lawan di posisi baru
                    checkAndKillOpponent(piece);

                    updateMessage("Bidak keluar dari pangkalan!");
                    drawBoard();

                    // Jika dapat 6, lempar lagi
                    setTimeout(() => {
                        updateMessage("Anda dapat 6, lempar dadu lagi!");
                        game.isRollable = true;
                        diceDisplay.textContent = '';
                    }, 1000);
                } else {
                    updateMessage("Bidak tidak bisa keluar. Perlu dadu 6.");
                    game.isRollable = true; // izinkan dadu dilempar lagi jika giliran tidak berubah
                }
                return;
            }

            // Logika pergerakan normal
            if (oldPos >= 0) {
                // Memastikan langkah tidak melewati jalur akhir
                const totalPathLength = info.path.length;
                const totalMove = oldPos + steps;
                
                if (totalMove >= totalPathLength && totalMove < totalPathLength + info.finalPath.length) {
                    // Masuk ke jalur final
                    const finalPathIndex = totalMove - totalPathLength;
                    const newCoords = info.finalPath[finalPathIndex];
                    piece.x = newCoords.x;
                    piece.y = newCoords.y;
                    piece.pos = newPos;
                    updateMessage(`Bidak bergerak ${steps} langkah ke jalur akhir.`);
                } else if (totalMove >= totalPathLength + info.finalPath.length) {
                    // Masuk ke rumah
                    piece.isHome = true;
                    piece.x = info.homePos.x;
                    piece.y = info.homePos.y;
                    piece.pos = -2; // Posisi spesial untuk di rumah
                    updateMessage("Bidak berhasil mencapai rumah!");
                    checkWin();
                } else if (totalMove < totalPathLength) {
                    // Bergerak di jalur utama
                    piece.pos = newPos;
                    const newCoords = info.path[piece.pos];
                    piece.x = newCoords.x;
                    piece.y = newCoords.y;
                    checkAndKillOpponent(piece);
                    updateMessage(`Bidak bergerak ${steps} langkah.`);
                } else {
                    // Terlalu banyak langkah untuk mencapai rumah, giliran selesai
                    updateMessage("Bidak tidak bisa bergerak, terlalu jauh.");
                    drawBoard();
                    setTimeout(switchTurn, 1000);
                    return;
                }
                
                drawBoard();

                // Jika dadu 6, dapat giliran lagi
                if (steps === 6) {
                    setTimeout(() => {
                        updateMessage("Anda dapat 6, lempar dadu lagi!");
                        game.isRollable = true;
                        diceDisplay.textContent = '';
                    }, 1000);
                } else {
                    setTimeout(switchTurn, 1000);
                }
            }
        }

        function checkAndKillOpponent(movingPiece) {
            const currentPlayer = game.turn;
            game.players.forEach(opponent => {
                if (opponent !== currentPlayer) {
                    const opponentPieces = game.pieces[opponent];
                    opponentPieces.forEach(oppPiece => {
                        // Jika bidak lawan ada di posisi yang sama dan bidak lawan sudah keluar
                        if (oppPiece.x === movingPiece.x && oppPiece.y === movingPiece.y && oppPiece.isReady) {
                            // Pindahkan bidak lawan kembali ke pangkalan
                            const baseIndex = playerInfo[opponent].base.findIndex(p => p.x === oppPiece.x && p.y === oppPiece.y);
                            oppPiece.x = playerInfo[opponent].base[baseIndex].x;
                            oppPiece.y = playerInfo[opponent].base[baseIndex].y;
                            oppPiece.pos = -1;
                            oppPiece.isReady = false;
                            updateMessage(`Bidak ${playerNames[opponent]} berhasil dikembalikan ke pangkalan!`);
                        }
                    });
                }
            });
        }
        
        function checkWin() {
            const player = game.turn;
            const piecesAtHome = game.pieces[player].filter(p => p.isHome).length;
            if (piecesAtHome === game.pieces[player].length) {
                updateMessage(`Selamat! Pemain ${playerNames[player]} memenangkan pertandingan!`);
                rollBtn.disabled = true;
            }
        }

        function getClickedPiece(event) {
            const rect = canvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // Konversi koordinat mouse ke koordinat petak
            const tileX = Math.floor(x / TILE_SIZE);
            const tileY = Math.floor(y / TILE_SIZE);

            // Cari bidak yang diklik
            return game.pieces[game.turn].find(piece => piece.x === tileX && piece.y === tileY);
        }

        // --- Event Listener ---

        rollBtn.addEventListener('click', rollDice);

        canvas.addEventListener('click', (event) => {
            if (game.isRollable || game.diceValue === 0) return;
            
            const clickedPiece = getClickedPiece(event);
            if (!clickedPiece) {
                return;
            }

            // Aturan pergerakan
            if (clickedPiece.isReady) {
                // Bidak sudah keluar dari pangkalan
                movePiece(clickedPiece, game.diceValue);
            } else {
                // Bidak masih di pangkalan, hanya bisa keluar dengan dadu 6
                if (game.diceValue === 6) {
                    movePiece(clickedPiece, 6);
                } else {
                    updateMessage("Bidak ini tidak bisa bergerak. Perlu dadu 6 untuk keluar.");
                }
            }
        });

        // --- Inisialisasi Permainan ---
        window.onload = function() {
            drawBoard();
        };

    </script>
</body>
</html>
